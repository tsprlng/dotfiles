#!/usr/bin/perl

print "{\"version\":1}\n";
print "[\n";

$|=1;

my $first = 1;
while(1){
open(STATUS, "/usr/bin/i3status |");
while (<STATUS>) {
	next unless m[^,?\[\{] and m[\}\]$];  # skip duplicate headers or mangled lines
	s/^,//;

	my $v = `volume` || '??'; chomp $v;
	s/(\{"name":"tz)/{"name":"volume","full_text":"$v"},\1/;
	
	print $first ? $_ : ",$_";
	$first = 0;
}
}
