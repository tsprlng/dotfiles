#!/usr/bin/perl

print "{\"version\":1}\n";
print "[\n";

$|=1;

my $first = 1;
while(1){
open(STATUS, "/usr/bin/i3status |");
while (<STATUS>) {
	next unless m[^,?\[\{] and m[\}\]$];  # skip duplicate headers or mangled lines
	s/^,//;

	my $b = `brightness`;
	$b = sprintf("%.0f", $b);
	my $v = `volume` || '??'; chomp $v;
	my $e = 'ðŸ”Š';  # ðŸ”‡ðŸ”ˆðŸ”‰
	my $e = ($v gt 'M' || $v == 0) ? 'ðŸ”‡' : $v > 50 ? 'ðŸ”Š' : 'ðŸ”‰';
	s/(\{"name":"tz)/{"name":"brightness","full_text":"â˜¼ $b%"},{"name":"volume","full_text":"$e $v"},\1/;
	
	print $first ? $_ : ",$_";
	$first = 0;
}
}
