#!/usr/bin/zsh

device="/sys/class/backlight/intel_backlight"
curr="$(< "$device/brightness")"
max="$(< "$device/max_brightness")"

step=30
if (( $curr * 100 / $max < 8 )); then
	step=3
fi

get() {
  echo "$curr / $max"
  echo "$(( $curr * 100 / $max ))"
}

notify() {
  pkill -USR1 -o -f ~/bin/i3status
}

if [[ "$@" =~ up ]]; then
  (( $step + $curr > $max )) && step="$(( $max - $curr ))"
  echo "$(( $curr + step ))" > "$device/brightness"
  notify
elif [[ "$@" =~ down ]]; then
  (( $step > $curr )) && step=$curr
  echo "$(( $curr - step ))" > "$device/brightness"
  notify
elif [[ "$@" =~ max ]]; then
  echo "$max" > "$device/brightness"
  notify
elif [[ "$@" =~ min ]]; then
  zselect -t 80
  xset dpms force off
elif [[ "$@" =~ notify ]]; then
  notify
else
  get
fi

exit 0
