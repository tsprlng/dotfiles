#!/bin/bash

amixer -c 1 cget numid=24 | tail -n 1 | fgrep -q 'on'
is_headphone=$?

set -e

get() {
  if [[ "$*" =~ "-v" ]]; then
    echo "master  $(amixer -c 1 -M sget Master Playback)"
    echo "headphn $(amixer -c 1 -M sget Headphone Playback)"
    echo "speaker $(amixer -c 1 -M sget Speaker Playback)"
    echo
  fi
  if [[ $is_headphone -eq 0 ]]; then
    stuff="$(amixer -c 1 -M sget Headphone Playback)"
  else
    stuff="$(amixer -c 1 -M sget Speaker Playback)"
  fi
  echo "$stuff" | egrep -o '[0-9]+%' -m 1
  if amixer -c 1 sget Master Playback | fgrep -q '[off]'; then
    echo "Mute"
  fi
  echo "$stuff"
}

control=''
if [[ $is_headphone -eq 0 ]]; then
  control='Headphone'
else
  control='Speaker'
fi

if [[ "$@" =~ up ]]; then
  amixer -c 1 -M set $control Playback 2%+
elif [[ "$@" =~ down ]]; then
  amixer -c 1 -M set $control Playback 2%-
elif [[ "$@" =~ mute ]]; then
  amixer -c 1 -M set Master Playback toggle
elif [[ "$@" =~ zero ]]; then
  amixer -c 1 -M set $control Playback 0%
  amixer -c 1 -M set Master Playback unmute
  amixer -c 1 -M set Master Playback 100%
else
  get "$@"
fi

exit 0
